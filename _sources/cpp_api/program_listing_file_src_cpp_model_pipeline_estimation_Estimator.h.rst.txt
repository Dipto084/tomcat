
.. _program_listing_file_src_cpp_model_pipeline_estimation_Estimator.h:

Program Listing for File Estimator.h
====================================

|exhale_lsh| :ref:`Return to documentation for file <file_src_cpp_model_pipeline_estimation_Estimator.h>` (``src/cpp/model/pipeline/estimation/Estimator.h``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   #pragma once
   
   #include <memory>
   #include <set>
   #include <string>
   #include <unordered_set>
   #include <vector>
   
   #include <eigen3/Eigen/Dense>
   #include <nlohmann/json.hpp>
   
   #include "model/pgm/DynamicBayesNet.h"
   #include "model/pgm/EvidenceSet.h"
   #include "model/utils/Definitions.h"
   #include "model/utils/Tensor3.h"
   
   namespace tomcat {
       namespace model {
   
           //------------------------------------------------------------------
           // Structs
           //------------------------------------------------------------------
   
           struct NodeEstimates {
   
               std::string label;
   
               Eigen::VectorXd assignment;
   
               // Probabilities or densities calculated for n data points over
               // several time steps.
               Eigen::MatrixXd estimates;
           };
   
           class Estimator {
             public:
               //------------------------------------------------------------------
               // Constructors & Destructor
               //------------------------------------------------------------------
   
               Estimator();
   
               Estimator(std::shared_ptr<DynamicBayesNet> model, int inference_horizon);
   
               virtual ~Estimator();
   
               //------------------------------------------------------------------
               // Copy & Move constructors/assignments
               //------------------------------------------------------------------
   
               // Copy constructor and assignment should be deleted to avoid
               // implicit slicing and loss of polymorphic behaviour in the
               // subclasses. To deep copy, the clone method must be used.
               Estimator(const Estimator&) = delete;
   
               Estimator& operator=(const Estimator&) = delete;
   
               Estimator(Estimator&&) = default;
   
               Estimator& operator=(Estimator&&) = default;
   
               //------------------------------------------------------------------
               // Member functions
               //------------------------------------------------------------------
   
               void add_node(const std::string& node_label,
                             const Eigen::VectorXd& assignment);
   
               std::vector<NodeEstimates> get_estimates_at(int time_step) const;
   
               std::vector<NodeEstimates> get_estimates() const;
   
               //------------------------------------------------------------------
               // Virtual functions
               //------------------------------------------------------------------
   
               virtual void prepare();
   
               //------------------------------------------------------------------
               // Pure virtual functions
               //------------------------------------------------------------------
   
               virtual void estimate(EvidenceSet new_data) = 0;
   
               virtual void get_info(nlohmann::json& json) const = 0;
   
               virtual std::string get_name() const = 0;
   
               //------------------------------------------------------------------
               // Getters & Setters
               //------------------------------------------------------------------
               int get_inference_horizon() const;
   
               void set_training_data(const EvidenceSet& training_data);
   
             protected:
               //------------------------------------------------------------------
               // Member functions
               //------------------------------------------------------------------
   
               void copy_estimator(const Estimator& estimator);
   
               //------------------------------------------------------------------
               // Data members
               //------------------------------------------------------------------
               std::shared_ptr<DynamicBayesNet> model;
   
               // Data used to train the model. Baseline methods can use the
               // information in the training set to compute their estimations
               // instead of test data.
               EvidenceSet training_data;
   
               // Observed data to perform estimations. More data points can be
               // appended as estimations are made. Each derived class must store
               // computations to avoid recalculations as new data is available.
               EvidenceSet test_data;
   
               // List of nodes to estimate, their assignments and estimates
               std::vector<NodeEstimates> nodes_estimates;
   
               // An inference horizon determines if the task is a prediction (> 0)
               // or an inference (= 0). If it's a prediction, the horizon
               // determines up to how much further in the future predictions are
               // made.
               int inference_horizon;
           };
   
       } // namespace model
   } // namespace tomcat
